#!poetry_activate
import psutil


def memory_usage_psutil(pid_or_proc_name):
    """Find the memory usage using psutil"""
   
    pid_or_proc_name = str(pid_or_proc_name)
    mem_info = 0
    running = 0
    # iter over processes and find the desired one
    for proc in psutil.process_iter(['pid', 'name', 'username']):
        if (
                pid_or_proc_name in proc.name().lower()
                or pid_or_proc_name in str(proc.pid)
        ):
            running += 1
            mem_info += proc.memory_info().rss / 1024 / 1024
    return "{:.2f} MB, Found {} running".format(mem_info, running)


if __name__ == "__main__":
    import argh
    argh.dispatch_command(memory_usage_psutil)
